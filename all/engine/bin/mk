#!/bin/bash

. $PROJ_BASE/etc/init.sh || exit $?

cd ..
IFS=$'\n' targets=($(find out -maxdepth 1 -mindepth 1 -type d))
target_count=${#targets[@]}

[[ $target_count -eq 0 ]] && die "No make targets (out/*) found"

threads=1000

if [[ $target_count -eq 1 ]]; then
    # No need for the user to specify target
    target=${targets[0]}
elif [[ $# -eq 0 ]]; then
    echo
    echo "Ambiguous make target; possible targets:"
    for target in ${targets[@]}; do
        echo " - $target"
    done
    echo
    echo "Usage: $(basename $0) [make_target]"
    exit 1
else
    target=$1
fi

ninja -j$threads -C $target
