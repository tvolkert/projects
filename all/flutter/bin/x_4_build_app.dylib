#!/bin/bash

. $PROJ_BASE/etc/defs.sh || exit $?
[[ $(basename $PWD) == "ios" ]] || die "$(basename $0) must be run from ios dir"

set -ex

pushd ..

mv build/aot/snapshot_aot_vmisolate build/aot/kDartVmIsolateSnapshotBuffer
mv build/aot/snapshot_aot_isolate build/aot/kDartIsolateSnapshotBuffer

pushd build/aot

xxd --include kDartVmIsolateSnapshotBuffer kDartVmIsolateSnapshotBuffer.c
xxd --include kDartIsolateSnapshotBuffer kDartIsolateSnapshotBuffer.c

popd

xcrun cc \
      -arch arm64 \
      -miphoneos-version-min=8.0 \
      -c build/aot/kDartVmIsolateSnapshotBuffer.c \
      -o build/aot/kDartVmIsolateSnapshotBuffer.o
xcrun cc \
      -arch arm64 \
      -miphoneos-version-min=8.0 \
      -c build/aot/kDartIsolateSnapshotBuffer.c \
      -o build/aot/kDartIsolateSnapshotBuffer.o

export CODE_SIGNING_ALLOWED=YES
export CODE_SIGNING_REQUIRED=YES
export CODE_SIGN_CONTEXT_CLASS=XCiPhoneOSCodeSignContext
export CODE_SIGN_IDENTITY="iPhone Developer"
export CURRENT_ARCH=arm64
export EXPANDED_CODE_SIGN_IDENTITY=461536A6B8204B56D1E8C6916507B552CEA7C1FC
export EXPANDED_CODE_SIGN_IDENTITY_NAME="iPhone Developer: Google Development (3F4Y5873JF)"
export FLUTTER_APPLICATION_PATH=/Users/tvolkert/project/flutter/flutter/examples/baz
export FLUTTER_BUILD_MODE=debug
#export FLUTTER_BUILD_MODE=release
#export FLUTTER_FRAMEWORK_DIR=/Users/tvolkert/project/flutter/flutter/bin/cache/artifacts/engine/ios-release
#export FLUTTER_FRAMEWORK_DIR=/Users/tvolkert/project/flutter/flutter/bin/cache/artifacts/engine/ios
export FLUTTER_FRAMEWORK_DIR=/Users/tvolkert/project/flutter/engine/src/out/ios_debug_unopt \
export FLUTTER_ROOT=/Users/tvolkert/project/flutter/flutter
export FLUTTER_TARGET=lib/main.dart
export LOCAL_ENGINE=/Users/tvolkert/project/flutter/engine/src/out/ios_debug_unopt \
export SOURCE_ROOT=/Users/tvolkert/project/flutter/flutter/examples/baz/ios
##############
export ACTION=build
export AD_HOC_CODE_SIGNING_ALLOWED=NO
export ALTERNATE_GROUP=eng
export ALTERNATE_MODE=u+w,go-w,a+rX
export ALTERNATE_OWNER=tvolkert
export ALWAYS_SEARCH_USER_PATHS=NO
export ALWAYS_USE_SEPARATE_HEADERMAPS=NO
export APPLE_INTERNAL_DEVELOPER_DIR=/AppleInternal/Developer
export APPLE_INTERNAL_DIR=/AppleInternal
export APPLE_INTERNAL_DOCUMENTATION_DIR=/AppleInternal/Documentation
export APPLE_INTERNAL_LIBRARY_DIR=/AppleInternal/Library
export APPLE_INTERNAL_TOOLS=/AppleInternal/Developer/Tools
export APPLICATION_EXTENSION_API_ONLY=NO
export APPLY_RULES_IN_COPY_FILES=NO
export ARCHS=arm64
export ARCHS_STANDARD="armv7 arm64"
export ARCHS_STANDARD_32_64_BIT="armv7 arm64"
export ARCHS_STANDARD_32_BIT=armv7
export ARCHS_STANDARD_64_BIT=arm64
export ARCHS_STANDARD_INCLUDING_64_BIT="armv7 arm64"
export ARCHS_UNIVERSAL_IPHONE_OS="armv7 arm64"
export ASSETCATALOG_COMPILER_APPICON_NAME=AppIcon
export AVAILABLE_PLATFORMS="appletvos appletvsimulator iphoneos iphonesimulator macosx watchos watchsimulator"
export BITCODE_GENERATION_MODE=marker
export BUILD_ACTIVE_RESOURCES_ONLY=NO
export BUILD_COMPONENTS="headers build"
export BUILD_DIR=/Users/tvolkert/project/flutter/flutter/examples/baz/ios/build
export BUILD_ROOT=/Users/tvolkert/project/flutter/flutter/examples/baz/ios/build
export BUILD_STYLE=
export BUILD_VARIANTS=normal
export BUILT_PRODUCTS_DIR=/Users/tvolkert/project/flutter/flutter/examples/baz/ios/build/Release-iphoneos
export CACHE_ROOT=/var/folders/n5/klvyv2fj5lj2lhn_61080t0m003g3j/C/com.apple.DeveloperTools/7.3.1-7D1014/Xcode
export CCHROOT=/var/folders/n5/klvyv2fj5lj2lhn_61080t0m003g3j/C/com.apple.DeveloperTools/7.3.1-7D1014/Xcode
export CHMOD=/bin/chmod
export CHOWN=/usr/sbin/chown
export CLANG_ANALYZER_NONNULL=YES
export CLANG_CXX_LANGUAGE_STANDARD=gnu++0x
export CLANG_CXX_LIBRARY=libc++
export CLANG_ENABLE_MODULES=YES
export CLANG_ENABLE_OBJC_ARC=YES
export CLANG_MODULES_BUILD_SESSION_FILE=/var/folders/n5/klvyv2fj5lj2lhn_61080t0m003g3j/C/org.llvm.clang/ModuleCache/Session.modulevalidation
export CLANG_WARN_BOOL_CONVERSION=YES
export CLANG_WARN_CONSTANT_CONVERSION=YES
export CLANG_WARN_DIRECT_OBJC_ISA_USAGE=YES_ERROR
export CLANG_WARN_EMPTY_BODY=YES
export CLANG_WARN_ENUM_CONVERSION=YES
export CLANG_WARN_INT_CONVERSION=YES
export CLANG_WARN_OBJC_ROOT_CLASS=YES_ERROR
export CLANG_WARN_UNREACHABLE_CODE=YES
export CLANG_WARN__DUPLICATE_METHOD_MATCH=YES
export CLASS_FILE_DIR=/Users/tvolkert/project/flutter/flutter/examples/baz/ios/build/Runner.build/Release-iphoneos/Runner.build/JavaClasses
export CLEAN_PRECOMPS=YES
export CLONE_HEADERS=NO
export CODESIGNING_FOLDER_PATH=/Users/tvolkert/project/flutter/flutter/examples/baz/ios/build/Release-iphoneos/Runner.app
export COLOR_DIAGNOSTICS=NO
export COMBINE_HIDPI_IMAGES=NO
export COMMAND_MODE=legacy
export COMPOSITE_SDK_DIRS=/var/folders/n5/klvyv2fj5lj2lhn_61080t0m003g3j/C/com.apple.DeveloperTools/7.3.1-7D1014/Xcode/CompositeSDKs
export COMPRESS_PNG_FILES=YES
export CONFIGURATION=Release
export CONFIGURATION_BUILD_DIR=/Users/tvolkert/project/flutter/flutter/examples/baz/ios/build/Release-iphoneos
export CONFIGURATION_TEMP_DIR=/Users/tvolkert/project/flutter/flutter/examples/baz/ios/build/Runner.build/Release-iphoneos
export CONTENTS_FOLDER_PATH=Runner.app
export COPYING_PRESERVES_HFS_DATA=NO
export COPY_HEADERS_RUN_UNIFDEF=NO
export COPY_PHASE_STRIP=NO
export COPY_RESOURCES_FROM_STATIC_FRAMEWORKS=YES
export CORRESPONDING_SIMULATOR_PLATFORM_DIR=/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneSimulator.platform
export CORRESPONDING_SIMULATOR_PLATFORM_NAME=iphonesimulator
export CORRESPONDING_SIMULATOR_SDK_DIR=/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator9.3.sdk
export CORRESPONDING_SIMULATOR_SDK_NAME=iphonesimulator9.3
export CP=/bin/cp
export CREATE_INFOPLIST_SECTION_IN_BINARY=NO
export CURRENT_VARIANT=normal
export DEAD_CODE_STRIPPING=YES
export DEBUGGING_SYMBOLS=YES
export DEBUG_INFORMATION_FORMAT=dwarf-with-dsym
export DEFAULT_COMPILER=com.apple.compilers.llvm.clang.1_0
export DEFAULT_KEXT_INSTALL_PATH=/System/Library/Extensions
export DEFINES_MODULE=NO
export DEPLOYMENT_LOCATION=NO
export DEPLOYMENT_POSTPROCESSING=NO
export DEPLOYMENT_TARGET_CLANG_ENV_NAME=IPHONEOS_DEPLOYMENT_TARGET
export DEPLOYMENT_TARGET_CLANG_FLAG_NAME=miphoneos-version-min
export DEPLOYMENT_TARGET_CLANG_FLAG_PREFIX=-miphoneos-version-min=
export DEPLOYMENT_TARGET_SETTING_NAME=IPHONEOS_DEPLOYMENT_TARGET
export DEPLOYMENT_TARGET_SUGGESTED_VALUES="6.0 6.1 7.0 7.1 8.0 8.1 8.2 8.3 8.4 9.0 9.1 9.2 9.3"
export DERIVED_FILES_DIR=/Users/tvolkert/project/flutter/flutter/examples/baz/ios/build/Runner.build/Release-iphoneos/Runner.build/DerivedSources
export DERIVED_FILE_DIR=/Users/tvolkert/project/flutter/flutter/examples/baz/ios/build/Runner.build/Release-iphoneos/Runner.build/DerivedSources
export DERIVED_SOURCES_DIR=/Users/tvolkert/project/flutter/flutter/examples/baz/ios/build/Runner.build/Release-iphoneos/Runner.build/DerivedSources
export DEVELOPER_APPLICATIONS_DIR=/Applications/Xcode.app/Contents/Developer/Applications
export DEVELOPER_BIN_DIR=/Applications/Xcode.app/Contents/Developer/usr/bin
export DEVELOPER_DIR=/Applications/Xcode.app/Contents/Developer
export DEVELOPER_FRAMEWORKS_DIR=/Applications/Xcode.app/Contents/Developer/Library/Frameworks
export DEVELOPER_FRAMEWORKS_DIR_QUOTED=/Applications/Xcode.app/Contents/Developer/Library/Frameworks
export DEVELOPER_LIBRARY_DIR=/Applications/Xcode.app/Contents/Developer/Library
export DEVELOPER_SDK_DIR=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs
export DEVELOPER_TOOLS_DIR=/Applications/Xcode.app/Contents/Developer/Tools
export DEVELOPER_USR_DIR=/Applications/Xcode.app/Contents/Developer/usr
export DEVELOPMENT_LANGUAGE=English
export DOCUMENTATION_FOLDER_PATH=Runner.app/English.lproj/Documentation
export DO_HEADER_SCANNING_IN_JAM=NO
export DSTROOT=/tmp/Runner.dst
export DT_TOOLCHAIN_DIR=/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain
export DWARF_DSYM_FILE_NAME=Runner.app.dSYM
export DWARF_DSYM_FILE_SHOULD_ACCOMPANY_PRODUCT=NO
export DWARF_DSYM_FOLDER_PATH=/Users/tvolkert/project/flutter/flutter/examples/baz/ios/build/Release-iphoneos
export EFFECTIVE_PLATFORM_NAME=-iphoneos
export EMBEDDED_CONTENT_CONTAINS_SWIFT=NO
export EMBEDDED_PROFILE_NAME=embedded.mobileprovision
export EMBED_ASSET_PACKS_IN_PRODUCT_BUNDLE=NO
export ENABLE_BITCODE=NO
export ENABLE_DEFAULT_HEADER_SEARCH_PATHS=YES
export ENABLE_HEADER_DEPENDENCIES=YES
export ENABLE_NS_ASSERTIONS=NO
export ENABLE_ON_DEMAND_RESOURCES=YES
export ENABLE_STRICT_OBJC_MSGSEND=YES
export ENABLE_TESTABILITY=NO
export ENTITLEMENTS_ALLOWED=YES
export ENTITLEMENTS_REQUIRED=YES
export EXCLUDED_INSTALLSRC_SUBDIRECTORY_PATTERNS=".DS_Store .svn .git .hg CVS"
export EXCLUDED_RECURSIVE_SEARCH_PATH_SUBDIRECTORIES="*.nib *.lproj *.framework *.gch *.xcode* *.xcassets (*) .DS_Store CVS .svn .git .hg *.pbproj *.pbxproj"
export EXECUTABLES_FOLDER_PATH=Runner.app/Executables
export EXECUTABLE_FOLDER_PATH=Runner.app
export EXECUTABLE_NAME=Runner
export EXECUTABLE_PATH=Runner.app/Runner
export EXPANDED_PROVISIONING_PROFILE=1b1ecc17-1812-4cb8-9619-4b3e0e2f407d
export FILE_LIST=/Users/tvolkert/project/flutter/flutter/examples/baz/ios/build/Runner.build/Release-iphoneos/Runner.build/Objects/LinkFileList
export FIXED_FILES_DIR=/Users/tvolkert/project/flutter/flutter/examples/baz/ios/build/Runner.build/Release-iphoneos/Runner.build/FixedFiles
export FRAMEWORKS_FOLDER_PATH=Runner.app/Frameworks
export FRAMEWORK_FLAG_PREFIX=-framework
export FRAMEWORK_SEARCH_PATHS="/Users/tvolkert/project/flutter/flutter/examples/baz/ios/build/Release-iphoneos  /Users/tvolkert/project/flutter/flutter/examples/baz/ios/Flutter"
export FRAMEWORK_VERSION=A
export FULL_PRODUCT_NAME=Runner.app
export GCC3_VERSION=3.3
export GCC_C_LANGUAGE_STANDARD=gnu99
export GCC_INLINES_ARE_PRIVATE_EXTERN=YES
export GCC_NO_COMMON_BLOCKS=YES
export GCC_PFE_FILE_C_DIALECTS="c objective-c c++ objective-c++"
export GCC_SYMBOLS_PRIVATE_EXTERN=YES
export GCC_THUMB_SUPPORT=YES
export GCC_TREAT_WARNINGS_AS_ERRORS=NO
export GCC_VERSION=com.apple.compilers.llvm.clang.1_0
export GCC_VERSION_IDENTIFIER=com_apple_compilers_llvm_clang_1_0
export GCC_WARN_64_TO_32_BIT_CONVERSION=YES
export GCC_WARN_ABOUT_RETURN_TYPE=YES_ERROR
export GCC_WARN_UNDECLARED_SELECTOR=YES
export GCC_WARN_UNINITIALIZED_AUTOS=YES_AGGRESSIVE
export GCC_WARN_UNUSED_FUNCTION=YES
export GCC_WARN_UNUSED_VARIABLE=YES
export GENERATE_MASTER_OBJECT_FILE=NO
export GENERATE_PKGINFO_FILE=YES
export GENERATE_PROFILING_CODE=NO
export GID=5000
export GROUP=eng
export HEADERMAP_INCLUDES_FLAT_ENTRIES_FOR_TARGET_BEING_BUILT=YES
export HEADERMAP_INCLUDES_FRAMEWORK_ENTRIES_FOR_ALL_PRODUCT_TYPES=YES
export HEADERMAP_INCLUDES_NONPUBLIC_NONPRIVATE_HEADERS=YES
export HEADERMAP_INCLUDES_PROJECT_HEADERS=YES
export HEADERMAP_USES_FRAMEWORK_PREFIX_ENTRIES=YES
export HEADERMAP_USES_VFS=NO
export HEADER_SEARCH_PATHS="/Users/tvolkert/project/flutter/flutter/examples/baz/ios/build/Release-iphoneos/include "
export HIDE_BITCODE_SYMBOLS=YES
export HOME=/Users/tvolkert
export ICONV=/usr/bin/iconv
export INFOPLIST_EXPAND_BUILD_SETTINGS=YES
export INFOPLIST_FILE=Runner/Info.plist
export INFOPLIST_OUTPUT_FORMAT=binary
export INFOPLIST_PATH=Runner.app/Info.plist
export INFOPLIST_PREPROCESS=NO
export INFOSTRINGS_PATH=Runner.app/English.lproj/InfoPlist.strings
export INSTALL_DIR=/tmp/Runner.dst/Applications
export INSTALL_GROUP=eng
export INSTALL_MODE_FLAG=u+w,go-w,a+rX
export INSTALL_OWNER=tvolkert
export INSTALL_PATH=/Applications
export INSTALL_ROOT=/tmp/Runner.dst
export IPHONEOS_DEPLOYMENT_TARGET=9.3
export JAVAC_DEFAULT_FLAGS="-J-Xms64m -J-XX:NewSize=4M -J-Dfile.encoding=UTF8"
export JAVA_APP_STUB=/System/Library/Frameworks/JavaVM.framework/Resources/MacOS/JavaApplicationStub
export JAVA_ARCHIVE_CLASSES=YES
export JAVA_ARCHIVE_TYPE=JAR
export JAVA_COMPILER=/usr/bin/javac
export JAVA_FOLDER_PATH=Runner.app/Java
export JAVA_FRAMEWORK_RESOURCES_DIRS=Resources
export JAVA_JAR_FLAGS=cv
export JAVA_SOURCE_SUBDIR=.
export JAVA_USE_DEPENDENCIES=YES
export JAVA_ZIP_FLAGS=-urg
export JIKES_DEFAULT_FLAGS="+E +OLDCSO"
export KEEP_PRIVATE_EXTERNS=NO
export LD_DEPENDENCY_INFO_FILE=/Users/tvolkert/project/flutter/flutter/examples/baz/ios/build/Runner.build/Release-iphoneos/Runner.build/Objects-normal/arm64/Runner_dependency_info.dat
export LD_GENERATE_MAP_FILE=NO
export LD_MAP_FILE_PATH=/Users/tvolkert/project/flutter/flutter/examples/baz/ios/build/Runner.build/Release-iphoneos/Runner.build/Runner-LinkMap-normal-arm64.txt
export LD_NO_PIE=NO
export LD_QUOTE_LINKER_ARGUMENTS_FOR_COMPILER_DRIVER=YES
export LD_RUNPATH_SEARCH_PATHS=" @executable_path/Frameworks"
export LEGACY_DEVELOPER_DIR=/Applications/Xcode.app/Contents/PlugIns/Xcode3Core.ideplugin/Contents/SharedSupport/Developer
export LEX=lex
export LIBRARY_FLAG_NOSPACE=YES
export LIBRARY_FLAG_PREFIX=-l
export LIBRARY_KEXT_INSTALL_PATH=/Library/Extensions
export LIBRARY_SEARCH_PATHS="/Users/tvolkert/project/flutter/flutter/examples/baz/ios/build/Release-iphoneos  /Users/tvolkert/project/flutter/flutter/examples/baz/ios/Flutter"
export LINKER_DISPLAYS_MANGLED_NAMES=NO
export LINK_FILE_LIST_normal_arm64=/Users/tvolkert/project/flutter/flutter/examples/baz/ios/build/Runner.build/Release-iphoneos/Runner.build/Objects-normal/arm64/Runner.LinkFileList
export LINK_WITH_STANDARD_LIBRARIES=YES
export LOCALIZABLE_CONTENT_DIR=
export LOCALIZED_RESOURCES_FOLDER_PATH=Runner.app/English.lproj
export LOCAL_ADMIN_APPS_DIR=/Applications/Utilities
export LOCAL_APPS_DIR=/Applications
export LOCAL_DEVELOPER_DIR=/Library/Developer
export LOCAL_LIBRARY_DIR=/Library
export LOCROOT=
export LOCSYMROOT=
export MACH_O_TYPE=mh_execute
export MAC_OS_X_PRODUCT_BUILD_VERSION=15F34
export MAC_OS_X_VERSION_ACTUAL=101105
export MAC_OS_X_VERSION_MAJOR=101100
export MAC_OS_X_VERSION_MINOR=1105
export MTL_ENABLE_DEBUG_INFO=NO
export NATIVE_ARCH=armv7
export NATIVE_ARCH_32_BIT=i386
export NATIVE_ARCH_64_BIT=x86_64
export NATIVE_ARCH_ACTUAL=x86_64
export NO_COMMON=YES
export OBJECT_FILE_DIR=/Users/tvolkert/project/flutter/flutter/examples/baz/ios/build/Runner.build/Release-iphoneos/Runner.build/Objects
export OBJECT_FILE_DIR_normal=/Users/tvolkert/project/flutter/flutter/examples/baz/ios/build/Runner.build/Release-iphoneos/Runner.build/Objects-normal
export OBJROOT=/Users/tvolkert/project/flutter/flutter/examples/baz/ios/build
export ONLY_ACTIVE_ARCH=YES
export OS=MACOS
export OSAC=/usr/bin/osacompile
export PACKAGE_TYPE=com.apple.package-type.wrapper.application
export PASCAL_STRINGS=YES
export PATH="/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin:/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/local/bin:/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/libexec:/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/usr/bin:/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/usr/local/bin:/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/usr/bin:/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/usr/local/bin:/Applications/Xcode.app/Contents/Developer/usr/bin:/Applications/Xcode.app/Contents/Developer/usr/local/bin:/Applications/Xcode.app/Contents/Developer/Tools:/Users/tvolkert/.projects/all/forgeonmac/bin:/Users/tvolkert/project/flutter/flutter/bin:/Users/tvolkert/project/flutter/engine/src/third_party/android_tools/sdk/platform-tools:/Users/tvolkert/project/flutter/flutter/bin/cache/dart-sdk/bin:/Users/tvolkert/project/depot_tools:/Users/tvolkert/bin:/usr/local/git/current/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/sbin:/usr/sbin:/sbin:/opt/X11/bin"
export PATH_PREFIXES_EXCLUDED_FROM_HEADER_DEPENDENCIES="/usr/include /usr/local/include /System/Library/Frameworks /System/Library/PrivateFrameworks /Applications/Xcode.app/Contents/Developer/Headers /Applications/Xcode.app/Contents/Developer/SDKs /Applications/Xcode.app/Contents/Developer/Platforms"
export PBDEVELOPMENTPLIST_PATH=Runner.app/pbdevelopment.plist
export PFE_FILE_C_DIALECTS=objective-c
export PKGINFO_FILE_PATH=/Users/tvolkert/project/flutter/flutter/examples/baz/ios/build/Runner.build/Release-iphoneos/Runner.build/PkgInfo
export PKGINFO_PATH=Runner.app/PkgInfo
export PLATFORM_DEVELOPER_APPLICATIONS_DIR=/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/Applications
export PLATFORM_DEVELOPER_BIN_DIR=/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/usr/bin
export PLATFORM_DEVELOPER_LIBRARY_DIR=/Applications/Xcode.app/Contents/PlugIns/Xcode3Core.ideplugin/Contents/SharedSupport/Developer/Library
export PLATFORM_DEVELOPER_SDK_DIR=/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/SDKs
export PLATFORM_DEVELOPER_TOOLS_DIR=/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/Tools
export PLATFORM_DEVELOPER_USR_DIR=/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/usr
export PLATFORM_DIR=/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform
export PLATFORM_DISPLAY_NAME=iOS
export PLATFORM_NAME=iphoneos
export PLATFORM_PREFERRED_ARCH=arm64
export PLATFORM_PRODUCT_BUILD_VERSION=13E230
export PLIST_FILE_OUTPUT_FORMAT=binary
export PLUGINS_FOLDER_PATH=Runner.app/PlugIns
export PRECOMPS_INCLUDE_HEADERS_FROM_BUILT_PRODUCTS_DIR=YES
export PRECOMP_DESTINATION_DIR=/Users/tvolkert/project/flutter/flutter/examples/baz/ios/build/Runner.build/Release-iphoneos/Runner.build/PrefixHeaders
export PRESERVE_DEAD_CODE_INITS_AND_TERMS=NO
export PRIVATE_HEADERS_FOLDER_PATH=Runner.app/PrivateHeaders
export PRODUCT_BUNDLE_IDENTIFIER=com.example.Runner
export PRODUCT_MODULE_NAME=Runner
export PRODUCT_NAME=Runner
export PRODUCT_SETTINGS_PATH=/Users/tvolkert/project/flutter/flutter/examples/baz/ios/Runner/Info.plist
export PRODUCT_TYPE=com.apple.product-type.application
export PROFILING_CODE=NO
export PROJECT=Runner
export PROJECT_DERIVED_FILE_DIR=/Users/tvolkert/project/flutter/flutter/examples/baz/ios/build/Runner.build/DerivedSources
export PROJECT_DIR=/Users/tvolkert/project/flutter/flutter/examples/baz/ios
export PROJECT_FILE_PATH=/Users/tvolkert/project/flutter/flutter/examples/baz/ios/Runner.xcodeproj
export PROJECT_NAME=Runner
export PROJECT_TEMP_DIR=/Users/tvolkert/project/flutter/flutter/examples/baz/ios/build/Runner.build
export PROJECT_TEMP_ROOT=/Users/tvolkert/project/flutter/flutter/examples/baz/ios/build
export PROVISIONING_PROFILE_REQUIRED=YES
export PUBLIC_HEADERS_FOLDER_PATH=Runner.app/Headers
export RECURSIVE_SEARCH_PATHS_FOLLOW_SYMLINKS=YES
export REMOVE_CVS_FROM_RESOURCES=YES
export REMOVE_GIT_FROM_RESOURCES=YES
export REMOVE_HEADERS_FROM_EMBEDDED_BUNDLES=YES
export REMOVE_HG_FROM_RESOURCES=YES
export REMOVE_SVN_FROM_RESOURCES=YES
export RESOURCE_RULES_REQUIRED=YES
export REZ_COLLECTOR_DIR=/Users/tvolkert/project/flutter/flutter/examples/baz/ios/build/Runner.build/Release-iphoneos/Runner.build/ResourceManagerResources
export REZ_OBJECTS_DIR=/Users/tvolkert/project/flutter/flutter/examples/baz/ios/build/Runner.build/Release-iphoneos/Runner.build/ResourceManagerResources/Objects
export REZ_SEARCH_PATHS="/Users/tvolkert/project/flutter/flutter/examples/baz/ios/build/Release-iphoneos "
export SCAN_ALL_SOURCE_FILES_FOR_INCLUDES=NO
export SCRIPTS_FOLDER_PATH=Runner.app/Scripts
export SCRIPT_INPUT_FILE_COUNT=0
export SCRIPT_OUTPUT_FILE_COUNT=0
export SDKROOT=/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS9.3.sdk
export SDK_DIR=/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS9.3.sdk
export SDK_DIR_iphoneos9_3=/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS9.3.sdk
export SDK_NAME=iphoneos9.3
export SDK_NAMES=iphoneos9.3
export SDK_PRODUCT_BUILD_VERSION=13E230
export SDK_VERSION=9.3
export SDK_VERSION_ACTUAL=90300
export SDK_VERSION_MAJOR=90000
export SDK_VERSION_MINOR=300
export SED=/usr/bin/sed
export SEPARATE_STRIP=NO
export SEPARATE_SYMBOL_EDIT=NO
export SET_DIR_MODE_OWNER_GROUP=YES
export SET_FILE_MODE_OWNER_GROUP=NO
export SHALLOW_BUNDLE=YES
export SHARED_DERIVED_FILE_DIR=/Users/tvolkert/project/flutter/flutter/examples/baz/ios/build/Release-iphoneos/DerivedSources
export SHARED_FRAMEWORKS_FOLDER_PATH=Runner.app/SharedFrameworks
export SHARED_PRECOMPS_DIR=/var/folders/n5/klvyv2fj5lj2lhn_61080t0m003g3j/C/com.apple.DeveloperTools/7.3.1-7D1014/Xcode/SharedPrecompiledHeaders
export SHARED_SUPPORT_FOLDER_PATH=Runner.app/SharedSupport
export SKIP_INSTALL=NO
export SKY_ROOT=/Users/tvolkert/project/flutter/engine/src
export SRCROOT=/Users/tvolkert/project/flutter/flutter/examples/baz/ios
export STRINGS_FILE_OUTPUT_ENCODING=binary
export STRIP_BITCODE_FROM_COPIED_FILES=YES
export STRIP_INSTALLED_PRODUCT=YES
export STRIP_STYLE=all
export SUPPORTED_DEVICE_FAMILIES=1,2
export SUPPORTED_PLATFORMS="iphonesimulator iphoneos"
export SUPPORTS_TEXT_BASED_API=NO
export SWIFT_PLATFORM_TARGET_PREFIX=ios
export SYMROOT=/Users/tvolkert/project/flutter/flutter/examples/baz/ios/build
export SYSTEM_ADMIN_APPS_DIR=/Applications/Utilities
export SYSTEM_APPS_DIR=/Applications
export SYSTEM_CORE_SERVICES_DIR=/System/Library/CoreServices
export SYSTEM_DEMOS_DIR=/Applications/Extras
export SYSTEM_DEVELOPER_APPS_DIR=/Applications/Xcode.app/Contents/Developer/Applications
export SYSTEM_DEVELOPER_BIN_DIR=/Applications/Xcode.app/Contents/Developer/usr/bin
export SYSTEM_DEVELOPER_DEMOS_DIR="/Applications/Xcode.app/Contents/Developer/Applications/Utilities/Built Examples"
export SYSTEM_DEVELOPER_DIR=/Applications/Xcode.app/Contents/Developer
export SYSTEM_DEVELOPER_DOC_DIR="/Applications/Xcode.app/Contents/Developer/ADC Reference Library"
export SYSTEM_DEVELOPER_GRAPHICS_TOOLS_DIR="/Applications/Xcode.app/Contents/Developer/Applications/Graphics Tools"
export SYSTEM_DEVELOPER_JAVA_TOOLS_DIR="/Applications/Xcode.app/Contents/Developer/Applications/Java Tools"
export SYSTEM_DEVELOPER_PERFORMANCE_TOOLS_DIR="/Applications/Xcode.app/Contents/Developer/Applications/Performance Tools"
export SYSTEM_DEVELOPER_RELEASENOTES_DIR="/Applications/Xcode.app/Contents/Developer/ADC Reference Library/releasenotes"
export SYSTEM_DEVELOPER_TOOLS=/Applications/Xcode.app/Contents/Developer/Tools
export SYSTEM_DEVELOPER_TOOLS_DOC_DIR="/Applications/Xcode.app/Contents/Developer/ADC Reference Library/documentation/DeveloperTools"
export SYSTEM_DEVELOPER_TOOLS_RELEASENOTES_DIR="/Applications/Xcode.app/Contents/Developer/ADC Reference Library/releasenotes/DeveloperTools"
export SYSTEM_DEVELOPER_USR_DIR=/Applications/Xcode.app/Contents/Developer/usr
export SYSTEM_DEVELOPER_UTILITIES_DIR=/Applications/Xcode.app/Contents/Developer/Applications/Utilities
export SYSTEM_DOCUMENTATION_DIR=/Library/Documentation
export SYSTEM_KEXT_INSTALL_PATH=/System/Library/Extensions
export SYSTEM_LIBRARY_DIR=/System/Library
export TAPI_VERIFY_MODE=ErrorsOnly
export TARGETED_DEVICE_FAMILY=1,2
export TARGETNAME=Runner
export TARGET_BUILD_DIR=/Users/tvolkert/project/flutter/flutter/examples/baz/ios/build/Release-iphoneos
export TARGET_NAME=Runner
export TARGET_TEMP_DIR=/Users/tvolkert/project/flutter/flutter/examples/baz/ios/build/Runner.build/Release-iphoneos/Runner.build
export TEMP_DIR=/Users/tvolkert/project/flutter/flutter/examples/baz/ios/build/Runner.build/Release-iphoneos/Runner.build
export TEMP_FILES_DIR=/Users/tvolkert/project/flutter/flutter/examples/baz/ios/build/Runner.build/Release-iphoneos/Runner.build
export TEMP_FILE_DIR=/Users/tvolkert/project/flutter/flutter/examples/baz/ios/build/Runner.build/Release-iphoneos/Runner.build
export TEMP_ROOT=/Users/tvolkert/project/flutter/flutter/examples/baz/ios/build
export TOOLCHAINS=com.apple.dt.toolchain.XcodeDefault
export TOOLCHAIN_DIR=/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain
export TREAT_MISSING_BASELINES_AS_TEST_FAILURES=NO
export UNLOCALIZED_RESOURCES_FOLDER_PATH=Runner.app
export UNSTRIPPED_PRODUCT=NO
export USER=tvolkert
export USER_APPS_DIR=/Users/tvolkert/Applications
export USER_LIBRARY_DIR=/Users/tvolkert/Library
export USE_DYNAMIC_NO_PIC=YES
export USE_HEADERMAP=YES
export USE_HEADER_SYMLINKS=NO
export VALIDATE_PRODUCT=YES
export VALID_ARCHS="arm64 armv7 armv7s"
export VERBOSE_PBXCP=NO
export VERSIONPLIST_PATH=Runner.app/version.plist
export VERSION_INFO_BUILDER=tvolkert
export VERSION_INFO_FILE=Runner_vers.c
export VERSION_INFO_STRING="\"@(#)PROGRAM:Runner  PROJECT:Runner-\""
export WRAPPER_EXTENSION=app
export WRAPPER_NAME=Runner.app
export WRAPPER_SUFFIX=.app
export WRAP_ASSET_PACKS_IN_SEPARATE_DIRECTORIES=NO
export XCODE_APP_SUPPORT_DIR=/Applications/Xcode.app/Contents/Developer/Library/Xcode
export XCODE_PRODUCT_BUILD_VERSION=7D1014
export XCODE_VERSION_ACTUAL=0731
export XCODE_VERSION_MAJOR=0700
export XCODE_VERSION_MINOR=0730
export XPCSERVICES_FOLDER_PATH=Runner.app/XPCServices
export YACC=yacc
export arch=arm64
export variant=normal

xcrun clang \
      -arch arm64 \
      -miphoneos-version-min=8.0 \
      -dynamiclib \
      -Xlinker -rpath -Xlinker @executable_path/Frameworks \
      -Xlinker -rpath -Xlinker @loader_path/Frameworks \
      -install_name @rpath/app.dylib \
      -o ios/Flutter/app.dylib \
      build/aot/kDartVmIsolateSnapshotBuffer.o build/aot/kDartIsolateSnapshotBuffer.o

rm -rf build

popd
