#!/bin/bash

. $PROJ_BASE/etc/defs.sh || exit $?
[[ $(basename $PWD) == "ios" ]] || die "$(basename $0) must be run from ios dir"

set -ex

cd ..
mkdir -p build/aot
/Users/tvolkert/projects/flutter/flutter/bin/cache/artifacts/engine/ios-release/gen_snapshot \
    --vm_isolate_snapshot=build/aot/snapshot_aot_vmisolate \
    --isolate_snapshot=build/aot/snapshot_aot_isolate \
    --packages=.packages \
    --url_mapping=dart:mojo.internal,/Users/tvolkert/.pub-cache/hosted/pub.dartlang.org/mojo-0.4.27/sdk_ext/internal.dart \
    --url_mapping=dart:ui,../../../../../../../flutter/flutter/bin/cache/pkg/sky_engine/dart_ui/ui.dart \
    --url_mapping=dart:jni,../../../../../../../flutter/flutter/bin/cache/pkg/sky_engine/dart_jni/jni.dart \
    --url_mapping=dart:vmservice_sky,../../../../../../../flutter/flutter/bin/cache/pkg/sky_engine/sdk_ext/dart/runtime/bin/vmservice/vmservice_io.dart \
    --embedder_entry_points_manifest=/Users/tvolkert/projects/flutter/flutter/bin/cache/artifacts/engine/ios-release/dart_vm_entry_points.txt \
    --embedder_entry_points_manifest=/Users/tvolkert/projects/flutter/flutter/bin/cache/artifacts/engine/ios-release/dart_io_entries.txt \
    --assembly=build/aot/snapshot_assembly.S \
    /Users/tvolkert/projects/forgeonmac/google3/experimental/users/tvolkert/fom/sample/lib/main.dart
cd -
